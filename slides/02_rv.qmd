---
title: "確率論"
subtitle: "確率変数"
author: "森 立平"
format:
  revealjs:
    slide-number: true
    smaller: true
    html-math-method: mathjax
    include-in-header: macros.qmd
jupyter: python3
css: slides.css
---

## 確率空間の公理

確率空間 $(\Omega,\,P)$ の公理

- $\Omega\colon$ (**非可算**でもよい)集合(**標本空間**)
- $P\colon 2^\Omega\to\mathbb{R}_{\ge 0}$ (**確率測度**)


:::{.wide-list}
1. $P(\Omega)=1$.
<!-- 2. ~~$\forall A, B\subseteq\Omega$, $A\cap B=\varnothing\implies P(A\cup B)=P(A)+P(B)$\ (有限加法性).~~ -->
1. $\forall (A_n\subseteq\Omega)_{n\ge 0}$, $\forall i\ne j,\, A_i\cap A_j=\varnothing\implies P\left(\bigcup_{n\ge0} A_n\right)=\sum_{n\ge0} P(A_n)$\ (**完全加法性, $\sigma$-加法性**).
:::

:::{.r-stack}
本当は正しくないけど
:::

## 確率空間の例

一回のコイン投げ

:::{.wide-list}
- $\Omega = \{\mathrm{H},\mathrm{T}\}$.
- $P(A) = \frac{|A|}2\qquad\forall A\subseteq\Omega$.
:::

二回の独立なコイン投げ

:::{.wide-list}
- $\Omega = \{\mathrm{HH},\mathrm{HT},\mathrm{TH},\mathrm{TT}\}$.
- $P(A) = \frac{|A|}4\qquad\forall A\subseteq\Omega$.
:::

無限回の独立なコイン投げ

:::{.wide-list}
- $\Omega = \{\mathrm{H},\mathrm{T}\}^{\mathbb{N}}$.
- $P(A) = \frac{|A|}4\qquad\forall A\subseteq\Omega$.
:::

実数

:::{.wide-list}
- $\Omega = [0,1)$.
- $P([a,b)) = b-a\qquad\forall A\subseteq\Omega$.
:::

## 確率変数
実際に知りたい情報は限定されている。

$100$ 回コインを投げると $2^{100}$ 通りの結果があるが、興味がある情報は例えば以下のものなど。

:::{.wide-list}
- $k$ 回目に表が出たか裏が出たか
- 表が出た回数
- 二回連続同じ面が出た回数
- 連続して何回表が出たか
:::

:::{.definition}

**確率変数**

$(\Omega,\,P)$ を確率空間とするとき、関数 $X\colon \Omega\to\mathbb{R}$ を確率変数とよぶ。
また、実数 $a\in\mathbb{R}$ について
\begin{align*}
\Pr(X\le a) &\coloneqq P(\left\{\omega\in\Omega\mid X(\omega)\le a\right\})
\end{align*}
と表す。
$\Pr(X\ge a),\,\Pr(X=a),\,\Pr(X<a),\,\Pr(X>a)$ なども同様に定義される。

:::

例えば、$\Omega=\{\mathrm{HH},\mathrm{HT},\mathrm{TH},\mathrm{TT}\}$ のとき、.

\begin{align*}
X_1(\mathrm{HH}) &= X_1(\mathrm{HT}) = 1,& X_1(\mathrm{TH}) = X_1(\mathrm{TT}) = 0\\
X_2(\mathrm{HH}) &= X_2(\mathrm{TH}) = 1,& X_2(\mathrm{HT}) = X_2(\mathrm{TT}) = 0\\
X&=X_1+X_2
\end{align*}

## 累積分布関数

確率変数 $X$ の**累積分布関数 (cumulative distribution function)**

\begin{align*}
F_X(x) &\coloneqq \Pr(X\le x)\qquad\forall x\in\mathbb{R}
\end{align*}

累積分布関数は定義より単調非減少関数であることが分かる。
累積分布関数は連続とは限らないが**右連続**であることは以下のように確認できる。

\begin{align*}
\lim_{n\to\infty} \Pr\left(X \le x + \frac1n\right) &=
\lim_{n\to\infty} P\left(\left\{\omega\in\Omega\mid X(\omega) \le x + \frac1n\right\}\right)\\
&= P\left(\bigcap_{n=1}^\infty \left\{\omega\in\Omega\mid X(\omega) \le x + \frac1n\right\}\right)\\
&= P\left(\left\{\omega\in\Omega\mid X(\omega) \le x\right\}\right)\\
&= \Pr\left(X\le x\right).
\end{align*}

## 累積分布関数の例


**二項分布** $\mathrm{Binom}(n,p)\colon$
表が出る確率が $p\in[0,1]$ のコインを独立に $n$ 回投げて表が出る回数

\begin{align*}
\Pr(X=k) &= \binom{n}{k} p^k(1-p)^{n-k}\qquad\forall k\in\{0,1,\dotsc,n\}\\
F_X(k) &= \sum_{i=0}^k \binom{n}{i} p^i(1-p)^{n-i}.
\end{align*}

```{python}
#| layout-ncol: 1
#| label: fig-binom-cdf
#| fig-cap:
#|  - "二項分布の累積分布関数"

import matplotlib.pyplot as plt
import numpy as np
from scipy.stats import binom

# パラメータの設定
n = 12       # 試行回数
p = 0.6      # 成功確率

# 取りうる値の範囲
x = np.arange(0, n+1)

# 二項分布のPMFの計算
pmf = binom.pmf(x, n, p)
cdf = binom.cdf(x, n, p)

# プロット

plt.figure(figsize=(8, 4))
plt.step(x, cdf, where='post')
plt.xticks(x)
plt.title(f'Cdf of binomial distribution with n={n}, p={p}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X\\leq k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```


## 離散型確率変数

**離散型確率変数**: 像が高々可算無限の確率変数

任意の $A\subseteq\mathrm{Image}(X)$ について、
\begin{align*}
\Pr(X\in A) &= P\left(\{\omega\in\Omega\mid X(\omega)\in A\}\right)\\
&= P\left(\bigcup_{x\in A} \{\omega\in\Omega\mid X(\omega)=x\}\right)\\
&= \sum_{x\in A} P\left(\{\omega\in\Omega\mid X(\omega)=x\}\right)\\
&= \sum_{x\in A} \Pr\left(X=x\right)
\end{align*}

**確率質量関数 (probability mass function)**
\begin{align*}
f_X(x)&\coloneqq \Pr(X=x)\qquad\forall x\in\mathbb{R}.
\end{align*}

すると
\begin{align*}
\Pr(X\in A) &= \sum_{x\in A} f_X(x).
\end{align*}

## 確率質量関数の例

**二項分布** $\mathrm{Binom}(n,p)$

\begin{align*}
f_X(k) &= \binom{n}{k} p^k(1-p)^{n-k}.
\end{align*}

```{python}
#| layout-ncol: 1
#| label: fig-binom
#| fig-cap:
#|  - "二項分布の確率質量関数"

import matplotlib.pyplot as plt
import numpy as np
from scipy.stats import binom

# パラメータの設定
n = 12       # 試行回数
p = 0.6      # 成功確率

# 取りうる値の範囲
x = np.arange(0, n+1)

# 二項分布のPMFの計算
pmf = binom.pmf(x, n, p)
cdf = binom.cdf(x, n, p)

# プロット
plt.figure(figsize=(8, 4))
plt.bar(x, pmf, tick_label=x)
plt.title(f'Pmf of binomial distribution with n={n}, p={p}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X=k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```
  

## 連続型確率変数

**連続型確率変数**: 離散型確率変数でない確率変数


**確率密度関数 (probability density function)**
\begin{align*}
\Pr(X\in A) &= \int_{A} f_X(x) \mathrm{d}x.
\end{align*}
を満たす関数 $f_X\colon\mathrm{R}\to\mathrm{R}_{\ge 0}$.

離散確率変数に対する
\begin{align*}
\Pr(X\in A) &= \sum_{x\in A} f_X(x)
\end{align*}

と同じ形。

一般的には確率密度関数は**存在するとは限らない**。

## 連続確率変数の例

**正規分布(ガウス分布)** $N(\mu,\sigma)\colon$

\begin{align*}
f_X(x) &= \frac1{\sqrt{2\pi\sigma^2}}\mathrm{e}^{-\frac{(x-\mu)^2}{2\sigma^2}},&
F_X(x) &= \int_{-\infty}^x \frac1{\sqrt{2\pi\sigma^2}}\mathrm{e}^{-\frac{(z-\mu)^2}{2\sigma^2}}\mathrm{d}z
\end{align*}

特に $\mu=0$, $\sigma=1$ のとき**標準正規分布**という。

```{python}
#| layout-ncol: 2
#| label: fig-normal-0
#| fig-cap:
#|  - "標準正規分布の確率密度関数"
#|  - "標準正規分布の累積分布関数"

import numpy as np
from scipy.stats import norm
import matplotlib.pyplot as plt

# パラメータの設定

# 取りうる値の範囲
x = np.linspace(norm.ppf(0.001), norm.ppf(0.999), 100)

# 一様分布のPMFの計算
pdf = norm.pdf(x)
cdf = norm.cdf(x)

# プロット
plt.figure(figsize=(6, 3))
plt.plot(x, pdf)
plt.title(f'Pdf of normal distribution with $\\mu = 0$ and $\\sigma = 1$')
plt.xlabel('$x$')
plt.ylabel('$f_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.plot(x, cdf)
plt.title(f'Cdf of normal distribution with $\\mu = 0$ and $\\sigma = 1$')
plt.xlabel('$x$')
plt.ylabel('$F_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## 離散確率変数の例

* **二項分布** $\mathrm{Binom}(n,p)$: 表が出る確率が $p$ のコインを $n$ 回独立に投げたとき、表が出る回数の分布
$$\Pr(X=k) = \binom{n}{k} p^k (1-p)^{n-k}.$$
* **幾何分布** $\mathrm{Geo}(p)$: 表が出るまでに投げるコインの回数の分布
$$\Pr(X=k) = (1-p)^{k-1}p.$$
* **超幾何分布** $\mathrm{HyperGeo}(N,K,n)$: 袋の中に $N$ 個のボールがあって、そのうち $K$ 個が当たりとし、 $n$ 個引いたときの当たりの個数の分布
$$\Pr(X=k) = \frac{\binom{K}{k}\binom{N-K}{n-k}}{\binom{N}{n}}.$$
* **ポアソン分布** $\mathrm{Poisson}(\lambda)$:
$$
\Pr(X=k) = \frac{\lambda^k}{k!}\mathrm{e}^{-\lambda}.
$$

## 幾何分布


$$
f_X(k) = (1-p)^{k-1}p,\qquad\forall k\ge 1
$$

```{python}
#| layout-ncol: 2
#| label: fig-geom
#| fig-cap:
#|  - "幾何分布の確率質量関数"
#|  - "幾何分布の累積分布関数"

import numpy as np
from scipy.stats import geom
import matplotlib.pyplot as plt

# パラメータの設定
n = 12       # 試行回数
p = 0.6      # 成功確率

# 取りうる値の範囲
k = np.arange(1, n+1)
kk = np.arange(0, n+1)

# 幾何分布のPMFの計算
pmf = geom.pmf(k, p)
cdf = geom.cdf(kk, p)

# プロット
plt.figure(figsize=(6, 3))
plt.bar(k, pmf, tick_label=k)
plt.title(f'Pmf of geometric distribution with p={p}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X=k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.step(kk, cdf, where='post')
plt.xticks(kk)
plt.title(f'Cdf of geometric distribution with p={p}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X\\leq k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## 超幾何分布

$$
f_X(k) = \frac{\binom{K}{k}\binom{N-K}{n-k}}{\binom{N}{n}},\qquad\forall k\in \{0,\dotsc,\min\{K, n\}\}
$$

```{python}
#| layout-ncol: 2
#| label: fig-hypergeom
#| fig-cap:
#|  - "超幾何分布の確率質量関数"
#|  - "超幾何分布の累積分布関数"

import numpy as np
from scipy.stats import hypergeom
import matplotlib.pyplot as plt

# パラメータの設定
N = 40
n = 16
K = 12

# 取りうる値の範囲
k = np.arange(0, K+1)

# 超幾何分布のPMFの計算
pmf = hypergeom.pmf(k, N, K, n)
cdf = hypergeom.cdf(k, N, K, n)

# プロット
plt.figure(figsize=(6, 3))
plt.bar(k, pmf, tick_label=k)
plt.title(f'Pmf of hypergeometric distribution with K={K}, N={N}, n = {n}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X=k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.step(k, cdf, where='post')
plt.xticks(k)
plt.title(f'Cdf of hypergeometric distribution with K={K}, N={N}, n = {n}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X\\leq k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## ポアソン分布

$$
f_X(k) = \frac{\lambda^k}{k!}\mathrm{e}^{-\lambda},\qquad \forall k\ge 0
$$

```{python}
#| layout-ncol: 2
#| label: fig-poisson
#| fig-cap:
#|  - "ポアソン分布の確率質量関数"
#|  - "ポアソン分布の累積分布関数"

import numpy as np
from scipy.stats import poisson
import matplotlib.pyplot as plt

# パラメータの設定
lam = 5

# 取りうる値の範囲
k = np.arange(0, 3*lam)

# ポアソン分布のPMFの計算
pmf = poisson.pmf(k, lam)
cdf = poisson.cdf(k, lam)

# プロット
plt.figure(figsize=(6, 3))
plt.bar(k, pmf, tick_label=k)
plt.title(f'Pmf of Poisson distribution with $\\lambda$={lam}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X=k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.step(k, cdf, where='post')
plt.xticks(k)
plt.title(f'Cdf of Poisson distribution with $\\lambda$={lam}')
plt.xlabel('$k$')
plt.ylabel('$\\Pr(X\\leq k)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## 一様分布

\begin{align*}
f_X(x) &= \begin{cases}
\frac1{b-a}& \text{if } x\in[a,b]\\
0&\text{otherwise}
\end{cases},&
F_X(x) &= \begin{cases}
0&\text{if } x < a\\
\frac{x-a}{b}&\text{if } x \in[a,b]\\
1&\text{otherwise.}
\end{cases}
\end{align*}

```{python}
#| layout-ncol: 2
#| label: fig-uniform
#| fig-cap:
#|  - "一様分布の確率密度関数"
#|  - "一様分布の累積分布関数"

import numpy as np
from scipy.stats import uniform
import matplotlib.pyplot as plt

# パラメータの設定

# 取りうる値の範囲
#x = np.linspace(uniform.ppf(0.01), uniform.ppf(0.99), 100)
x = np.linspace(-0.1, +1.1, 1000)

# 一様分布のPMFの計算
pdf = uniform.pdf(x)
cdf = uniform.cdf(x)

# プロット
plt.figure(figsize=(6, 3))
plt.plot(x, pdf)
plt.title(f'Pdf of Uniform distribution on $[0,1]$')
plt.xlabel('$x$')
plt.ylabel('$f_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.plot(x, cdf)
plt.title(f'Cdf of Uniform distribution on $[0,1]$')
plt.xlabel('$x$')
plt.ylabel('$F_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## 正規分布 (ガウス分布)

\begin{align*}
f_X(x) &= \frac1{\sqrt{2\pi\sigma^2}}\mathrm{e}^{-\frac{(x-\mu)^2}{2\sigma^2}},&
F_X(x) &= \int_{-\infty}^x \frac1{\sqrt{2\pi\sigma^2}}\mathrm{e}^{-\frac{(z-\mu)^2}{2\sigma^2}}\mathrm{d}z
\end{align*}

特に $\mu=0$, $\sigma=1$ のとき**標準正規分布**という。

```{python}
#| layout-ncol: 2
#| label: fig-normal
#| fig-cap:
#|  - "標準正規分布の確率密度関数"
#|  - "標準正規分布の累積分布関数"

import numpy as np
from scipy.stats import norm
import matplotlib.pyplot as plt

# パラメータの設定

# 取りうる値の範囲
x = np.linspace(norm.ppf(0.001), norm.ppf(0.999), 100)

# 一様分布のPMFの計算
pdf = norm.pdf(x)
cdf = norm.cdf(x)

# プロット
plt.figure(figsize=(6, 3))
plt.plot(x, pdf)
plt.title(f'Pdf of normal distribution with $\\mu = 0$ and $\\sigma = 1$')
plt.xlabel('$x$')
plt.ylabel('$f_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.plot(x, cdf)
plt.title(f'Cdf of normal distribution with $\\mu = 0$ and $\\sigma = 1$')
plt.xlabel('$x$')
plt.ylabel('$F_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## 指数分布

\begin{align*}
f_X(x) &= \begin{cases}
0&\text{if } x < 0\\
\lambda\mathrm{e}^{-\lambda x}&\text{otherwise}
\end{cases},&
F_X(x) &= \begin{cases}
0&\text{if } x < 0\\
1-\mathrm{e}^{-\lambda x}&\text{otherwise}
\end{cases}
\end{align*}

```{python}
#| layout-ncol: 2
#| label: fig-exp
#| fig-cap:
#|  - "指数分布の確率密度関数"
#|  - "指数分布の累積分布関数"

import numpy as np
from scipy.stats import expon
import matplotlib.pyplot as plt

# パラメータの設定

# 取りうる値の範囲
x = np.linspace(expon.ppf(0.001), expon.ppf(0.999), 100)

# PMFの計算
pdf = expon.pdf(x)
cdf = expon.cdf(x)

# プロット
plt.figure(figsize=(6, 3))
plt.plot(x, pdf)
plt.title(f'Pdf of exponential distribution with $\\lambda = 1$')
plt.xlabel('$x$')
plt.ylabel('$f_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

plt.figure(figsize=(6, 3))
plt.plot(x, cdf)
plt.title(f'Cdf of exponential distribution with $\\lambda = 1$')
plt.xlabel('$x$')
plt.ylabel('$F_X(x)$')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```

## 確率変数、確率分布、確率空間

## 確率密度関数

## 今週の課題

$X\sim\mathrm{Binom}(n,p)$ とする。

とするとき、以下の問に答えよ

::: {.wide-list}

1. $A\cup B$,&nbsp; $A\cap B$,&nbsp; $A\setminus B$,&nbsp; $(A\cup B)\cap C$ をもとめよ。
1. $P(\{1,3\})$,&nbsp; $P(\{2,4\})$,&nbsp; $P(\{5\})$,&nbsp; $P(\{6\})$ を $P(A),\,P(B),\,P(C)$ を用いて表せ。

:::
